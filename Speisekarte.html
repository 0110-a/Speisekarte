<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terrassa – Digitale Speisekarte</title>

    <script src="menu.js"></script>

    <style>
        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            line-height: 1.5;
            margin: 0;
            padding: 0;
        }

        .nav-bar {
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            gap: 11px;
            align-items: center;
            height: 56px;
            padding: 10px 18px 9px 18px;
            overflow-x: auto;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid #333;
        }

        .nav-link {
            text-decoration: none;
            white-space: nowrap;
            padding: 7px 12px;
            border-radius: 999px;
            border: 1px solid #444;
            color: #ffffff;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .nav-link:hover { background-color: #333; }

        .menu-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 68px 18px 88px;
        }

        .section-title {
            margin: 28px 0 14px;
            font-size: clamp(19px, 3.2vw, 28px);
            scroll-margin-top: 62px;
            color: #ffffff;
        }

        .product-grid {
            display: grid;
            gap: 14px;
            grid-template-columns: repeat(auto-fill, minmax(257px, 1fr));
        }

        .product-card {
            background: #2a2a2a;
            border-radius: 12px;
            box-shadow: 0 8px 22px rgba(0,0,0,.5);
            overflow: hidden;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            transition: all 0.2s ease;
        }

        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(0,0,0,0.7) !important;
        }

        .product-image{
            width: 100%;
            height: 160px;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            color: #ccc;
            overflow:hidden;
            background-repeat:no-repeat;
            background-position: 50% var(--offsetY, 50%);
            background-size: calc(100% * var(--zoom, 1));
        }

        .product-image.has-img{
            color:transparent;
        }

        .product-info { padding: 15px; }

        .product-name {
            margin: 0 0 7px;
            font-weight: 650;
            font-size: 18px;
            color: #ffffff;
        }

        .product-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            color: #cccccc;
        }

        .product-price { font-weight: 700; color: #ffffff; }

        /* ---------------------- MODAL ANPASSUNG ---------------------- */
        .modal {
            width: min(560px, 92vw);
            border: none;
            border-radius: 18px;
            padding: 0;
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.8);
        }

        .modal::backdrop {
            background: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            padding: 18px;
            background: #2a2a2a;
            color: #ffffff;
        }

        .modal-header {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .modal-close-btn {
            margin-left: auto;
            border: 1px solid #555;
            background: #444;
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-close-btn:hover { background: #555; }

        .modal-price {
            margin-left: auto;
            font-weight: 800;
            font-size: 18px;
            color: #ffffff;
        }

        .modal-category {
            color: #cccccc;
            margin: 8px 0;
        }

        .modal-description {
            margin-bottom: 15px;
            line-height: 1.6;
            color: #ffffff;
        }

        /* ---------------------- BILD IM MODAL KOMPAKT ---------------------- */
        .modal-image{
            width:100%;
            max-height:55vh;
            background:#111;
            margin-bottom:12px;
            border-radius:12px;
            overflow:hidden;
            display:flex;
            align-items:center;
            justify-content:center;
        }

        .modal-image img{
            max-width:100%;
            max-height:55vh;
            object-fit:contain;
            display:block;
        }

        .modal-image.empty{
            color:#ccc;
            font-size:13px;
            justify-content:center;
            align-items:center;
        }

        .footer {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 10px 18px;
            border-top: 1px solid #333;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            font-size: 13px;
            text-align: center;
            color: #ffffff;
            display:flex;
            justify-content:center;
            align-items:center;
            gap:8px;
        }

        .footer a{
            color:#60a5fa;
            text-decoration:none;
            font-weight:500;
        }
        .footer a:hover{
            text-decoration:underline;
        }

        @media (max-width: 768px) {
          .nav-bar { padding: 10px 12px; }
          .menu-container { padding: 60px 12px 80px; }
          .product-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
        }

        @media (max-width: 480px) {
          .product-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <nav class="nav-bar">
      <a href="#vorspeisen" class="nav-link">Vorspeisen</a>
      <a href="#hauptgerichte" class="nav-link">Hauptgerichte</a>
      <a href="#beilagen" class="nav-link">Beilagen</a>
      <a href="#dessert" class="nav-link">Dessert</a>
      <a href="#weisswein" class="nav-link">Weißwein</a>
      <a href="#rotwein" class="nav-link">Rotwein</a>
      <a href="#spritz" class="nav-link">Spritz & Apéritifs</a>
      <a href="#longdrinks" class="nav-link">Longdrinks</a>
      <a href="#softdrinks" class="nav-link">Softdrinks</a>
      <a href="#kaffee" class="nav-link">Kaffee</a>
    </nav>

    <main class="menu-container" id="menuContent">
        <p style="color:#ccc">Menü lädt…</p>
    </main>

    <dialog class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalProductName" style="color: #ffffff;"></h3>
                <div class="modal-price" id="modalProductPrice"></div>
                <button class="modal-close-btn" type="button" onclick="closeModal()">Schließen</button>
            </div>

            <div class="modal-image empty" id="modalProductImage">
                <span id="modalImageFallback">Kein Bild</span>
                <img id="modalImageTag" src="" alt="" style="display:none;">
            </div>

            <div class="modal-category" id="modalProductCategory"></div>
            <p class="modal-description" id="modalProductDescription"></p>
        </div>
    </dialog>

    <footer class="footer">
        <span>Terrassa ·</span>
        <a href="https://www.instagram.com/terrassa.stuttgart/?hl=de" target="_blank" rel="noopener noreferrer">
            @terrassa.stuttgart
        </a>
    </footer>

    <script>
        var menuContent = document.getElementById('menuContent');
        const productModal = document.getElementById('productModal');

        let modalProductName = document.getElementById('modalProductName');
        var modalProductPrice = document.getElementById('modalProductPrice');
        const modalProductCategory = document.getElementById('modalProductCategory');
        let modalProductDescription = document.getElementById('modalProductDescription');

        const modalProductImage = document.getElementById('modalProductImage');
        const modalImageTag = document.getElementById('modalImageTag');
        const modalImageFallback = document.getElementById('modalImageFallback');

        let produktListe = [];

        const catIds = {
            'Vorspeisen': 'vorspeisen',
            'Hauptgerichte': 'hauptgerichte',
            'Beilagen': 'beilagen',
            'Dessert': 'dessert',
            'Weißwein': 'weisswein',
            'Rotwein': 'rotwein',
            'Spritz & Apéritifs': 'spritz',
            'Longdrinks': 'longdrinks',
            'Softdrinks': 'softdrinks',
            'Kaffee': 'kaffee'
        };

        function formatPriceEUR(n) {
            const num = Number(n);
            if (!isFinite(num)) return '';
            return num.toFixed(2).replace('.', ',') + '€';
        }

        function loadFromMenuJs() {
            const data = window.MENU_DATA;
            if (!data || !Array.isArray(data.dishes)) {
                menuContent.innerHTML = "<p style='color:#ccc'>Menü konnte nicht geladen werden.</p>";
                return;
            }

            const dishes = data.dishes || [];
            produktListe = dishes.map(d => ({
                id: 'db-' + d.id,
                category: d.category,
                name: d.name,
                price: formatPriceEUR(d.price),
                desc: d.description || '',
                image: d.image_url || '',
                zoom: d.image_zoom != null ? d.image_zoom : 1.0,
                offsetY: d.image_offset_y != null ? d.image_offset_y : 50.0
            }));

            renderMenu();
        }

        function createSection(catName) {
            var items = produktListe.filter(x => x.category === catName);
            if (!items.length) return '';

            const sectionId = catIds[catName];
            let html = '<h2 class="section-title" id="' + sectionId + '">' + catName + '</h2><div class="product-grid">';

            for (let item of items) {
                if(item.image){
                    html += `
                      <article class="product-card" data-id="${item.id}">
                        <div class="product-image has-img"
                             style="background-image:url('${item.image}');
                                    --zoom:${item.zoom};
                                    --offsetY:${item.offsetY}%;"></div>
                        <div class="product-info">
                          <div class="product-name">${item.name}</div>
                          <div class="product-meta">
                            <div>${catName}</div>
                            <div class="product-price">${item.price}</div>
                          </div>
                        </div>
                      </article>
                    `;
                } else {
                    html += `
                      <article class="product-card" data-id="${item.id}">
                        <div class="product-image">Bild / Icon</div>
                        <div class="product-info">
                          <div class="product-name">${item.name}</div>
                          <div class="product-meta">
                            <div>${catName}</div>
                            <div class="product-price">${item.price}</div>
                          </div>
                        </div>
                      </article>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function renderMenu() {
            let output = '';
            const cats = ['Vorspeisen', 'Hauptgerichte', 'Beilagen', 'Dessert', 'Weißwein', 'Rotwein', 'Spritz & Apéritifs', 'Longdrinks', 'Softdrinks', 'Kaffee'];

            for (let c of cats) output += createSection(c);

            if (!output.trim()) {
                menuContent.innerHTML = "<p style='color:#ccc'>Keine aktiven Gerichte.</p>";
                return;
            }

            menuContent.innerHTML = output;
        }

        function openModal(productId) {
            const prodItem = produktListe.find(x => x.id === productId);
            if (!prodItem) return;

            modalProductName.textContent = prodItem.name;
            modalProductPrice.textContent = prodItem.price;
            modalProductCategory.textContent = prodItem.category;
            modalProductDescription.textContent = prodItem.desc || "Keine Beschreibung.";

            if (prodItem.image) {
                modalProductImage.classList.remove("empty");
                modalImageFallback.style.display = "none";
                modalImageTag.style.display = "block";
                modalImageTag.src = prodItem.image;
            } else {
                modalProductImage.classList.add("empty");
                modalImageFallback.style.display = "block";
                modalImageTag.style.display = "none";
            }

            productModal.showModal();
        }

        function closeModal() { productModal.close(); }

        document.addEventListener('DOMContentLoaded', function() {
            loadFromMenuJs();

            menuContent.addEventListener('click', function(event) {
                const card = event.target.closest('.product-card');
                if (card) openModal(card.getAttribute('data-id'));
            });

            productModal.addEventListener('click', function(event) {
                const rect = productModal.getBoundingClientRect();
                if (event.clientX < rect.left || event.clientX > rect.right || event.clientY < rect.top || event.clientY > rect.bottom) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>

